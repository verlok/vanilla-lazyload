const e="undefined"!=typeof window,t=e&&!("onscroll"in window)||"undefined"!=typeof navigator&&/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent),s=e&&"IntersectionObserver"in window,a=e&&"classList"in document.createElement("p"),r={elements_selector:"img",container:t||e?document:null,threshold:300,thresholds:null,data_src:"src",data_srcset:"srcset",data_sizes:"sizes",data_bg:"bg",data_poster:"poster",class_loading:"loading",class_loaded:"loaded",class_error:"error",load_delay:0,auto_unobserve:!0,callback_enter:null,callback_exit:null,callback_reveal:null,callback_loaded:null,callback_error:null,callback_finish:null,use_native:!1},l=function(e,t){var s;let a=new e(t);try{s=new CustomEvent("LazyLoad::Initialized",{detail:{instance:a}})}catch(e){(s=document.createEvent("CustomEvent")).initCustomEvent("LazyLoad::Initialized",!1,!1,{instance:a})}window.dispatchEvent(s)},n=(e,t)=>e.getAttribute("data-"+t),o=(e,t,s)=>{var a="data-"+t;null!==s?e.setAttribute(a,s):e.removeAttribute(a)},i=e=>"true"===n(e,"was-processed"),c=(e,t)=>o(e,"ll-timeout",t),d=e=>n(e,"ll-timeout"),_=e=>{let t=[];for(let s,a=0;s=e.children[a];a+=1)"SOURCE"===s.tagName&&t.push(s);return t},u=(e,t,s)=>{s&&e.setAttribute(t,s)},g=(e,t)=>{u(e,"sizes",n(e,t.data_sizes)),u(e,"srcset",n(e,t.data_srcset)),u(e,"src",n(e,t.data_src))},h={IMG:(e,t)=>{const s=e.parentNode;if(s&&"PICTURE"===s.tagName){_(s).forEach(e=>{g(e,t)})}g(e,t)},IFRAME:(e,t)=>{u(e,"src",n(e,t.data_src))},VIDEO:(e,t)=>{_(e).forEach(e=>{u(e,"src",n(e,t.data_src))}),u(e,"poster",n(e,t.data_poster)),u(e,"src",n(e,t.data_src)),e.load()}},v=(e,t)=>{const s=t._settings,a=e.tagName,r=h[a];if(r)return r(e,s),t.loadingCount+=1,void(t._elements=(l=t._elements,o=e,l.filter(e=>e!==o)));var l,o;((e,t)=>{const s=n(e,t.data_src),a=n(e,t.data_bg);s&&(e.style.backgroundImage=`url("${s}")`),a&&(e.style.backgroundImage=a)})(e,s)},m=(e,t)=>{a?e.classList.add(t):e.className+=(e.className?" ":"")+t},b=(e,t)=>{a?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")},f=(e,t,s,a)=>{e&&(void 0===a?void 0===s?e(t):e(t,s):e(t,s,a))},p=(e,t,s)=>{e.addEventListener(t,s)},E=(e,t,s)=>{e.removeEventListener(t,s)},w=(e,t,s)=>{E(e,"load",t),E(e,"loadeddata",t),E(e,"error",s)},y=function(e,t,s){var a=s._settings;const r=t?a.class_loaded:a.class_error,l=t?a.callback_loaded:a.callback_error,n=e.target;b(n,a.class_loading),m(n,r),f(l,n,s),s.loadingCount-=1,0===s._elements.length&&0===s.loadingCount&&f(a.callback_finish,s)},I=(e,t)=>{const s=r=>{y(r,!0,t),w(e,s,a)},a=r=>{y(r,!1,t),w(e,s,a)};((e,t,s)=>{p(e,"load",t),p(e,"loadeddata",t),p(e,"error",s)})(e,s,a)},k=["IMG","IFRAME","VIDEO"],A=(e,t)=>{var s=t._observer;L(e,t),s&&t._settings.auto_unobserve&&s.unobserve(e)},L=(e,t,s)=>{var a=t._settings;!s&&i(e)||(k.indexOf(e.tagName)>-1&&(I(e,t),m(e,a.class_loading)),v(e,t),(e=>{o(e,"was-processed","true")})(e),f(a.callback_reveal,e,t))},z=e=>{var t=d(e);t&&(clearTimeout(t),c(e,null))},N=(e,t,s)=>{const a=s._settings;f(a.callback_enter,e,t,s),a.load_delay?((e,t)=>{var s=t._settings.load_delay,a=d(e);a||(a=setTimeout((function(){A(e,t),z(e)}),s),c(e,a))})(e,s):A(e,s)},C=e=>{return!!s&&(e._observer=new IntersectionObserver(t=>{t.forEach(t=>(e=>e.isIntersecting||e.intersectionRatio>0)(t)?N(t.target,t,e):((e,t,s)=>{const a=s._settings;f(a.callback_exit,e,t,s),a.load_delay&&z(e)})(t.target,t,e))},{root:(t=e._settings).container===document?null:t.container,rootMargin:t.thresholds||t.threshold+"px"}),!0);var t},O=["IMG","IFRAME"],M=e=>Array.prototype.slice.call(e),x=(e,t)=>(e=>e.filter(e=>!i(e)))(M(e||(e=>e.container.querySelectorAll(e.elements_selector))(t))),R=e=>{var t=e._settings,s=t.container.querySelectorAll("."+t.class_error);M(s).forEach(e=>{b(e,t.class_error),(e=>{o(e,"was-processed",null)})(e)}),e.update()},T=function(t,s){var a;this._settings=(e=>Object.assign({},r,e))(t),this.loadingCount=0,C(this),this.update(s),a=this,e&&window.addEventListener("online",e=>{R(a)})};T.prototype={update:function(e){var s,a=this._settings;(this._elements=x(e,a),!t&&this._observer)?((e=>e.use_native&&"loading"in HTMLImageElement.prototype)(a)&&((s=this)._elements.forEach(e=>{-1!==O.indexOf(e.tagName)&&(e.setAttribute("loading","lazy"),L(e,s))}),this._elements=x(e,a)),this._elements.forEach(e=>{this._observer.observe(e)})):this.loadAll()},destroy:function(){this._observer&&(this._elements.forEach(e=>{this._observer.unobserve(e)}),this._observer=null),this._elements=null,this._settings=null},load:function(e,t){L(e,this,t)},loadAll:function(){this._elements.forEach(e=>{A(e,this)})}},e&&((e,t)=>{if(t)if(t.length)for(let s,a=0;s=t[a];a+=1)l(e,s);else l(e,t)})(T,window.lazyLoadOptions);export default T;
